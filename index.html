<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>HEIC/HEIF to JPG/PNG Converter (Offline · Client-side)</title>
  <meta name="description" content="Convert HEIC/HEIF images to JPG or PNG entirely in your browser. No uploads, no servers, no database. Batch conversion and ZIP download supported." />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <meta name="keywords" content="HEIC to JPG, HEIC to PNG, HEIF converter, client-side, offline, batch convert, privacy" />
  <meta name="theme-color" content="#0ea5e9" />

  <!-- ✅ 실제 배포 도메인으로 교체하세요 (SEO용 canonical/og:url) -->
  <link rel="canonical" href="https://imgheic.com/" />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="HEIC/HEIF → JPG/PNG (Offline · Client-side)" />
  <meta property="og:description" content="Drag & drop HEIC/HEIF files and convert them to JPG/PNG locally in your browser. No uploads. Batch convert + ZIP download." />
  <meta property="og:url" content="https://imgheic.com/" />
  <meta property="og:image" content="https://imgheic.com/" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="HEIC/HEIF → JPG/PNG (Offline · Client-side)" />
  <meta name="twitter:description" content="Fast, private HEIC/HEIF to JPG/PNG conversion in your browser. Batch convert and ZIP download supported." />
  <meta name="twitter:image" content="https://imgheic.com/" />

  <!-- 구조화 데이터: WebApplication (영문) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "HEIC/HEIF to JPG/PNG Converter",
    "url": "https://example.com/heic-to-jpg",
    "applicationCategory": "UtilityApplication",
    "operatingSystem": "All",
    "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
    "description": "Client-side HEIC/HEIF to JPG/PNG converter. Batch conversion and ZIP download, no uploads or databases."
  }
  </script>

  <!-- 구조화 데이터: FAQ (영문) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [{
      "@type": "Question",
      "name": "Are my files uploaded to a server?",
      "acceptedAnswer": { "@type": "Answer", "text": "No. All conversions happen locally in your browser; nothing is uploaded." }
    },{
      "@type": "Question",
      "name": "Is EXIF metadata preserved?",
      "acceptedAnswer": { "@type": "Answer", "text": "Generally no. Re-encoding to JPG/PNG via canvas typically strips EXIF metadata." }
    },{
      "@type": "Question",
      "name": "Can I convert multiple files at once?",
      "acceptedAnswer": { "@type": "Answer", "text": "Yes. Drag & drop or select multiple HEIC/HEIF files and convert them in a batch." }
    }]
  }
  </script>

  <style>
    /* ───────────── 기본 라이트 테마(다크 미지원) ───────────── */
    :root {
      --bg: #ffffff;
      --fg: #0b1324;
      --muted: #6b7280;
      --primary: #0ea5e9;
      --ring: rgba(14,165,233,0.35);
      --border: #e5e7eb;
      --card: #f8fafc;
      --good: #16a34a;
      --bad: #dc2626;
    }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", sans-serif; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px 16px 64px; }
    header { text-align:center; margin-bottom: 18px; }
    h1 { font-size: 28px; margin: 10px 0 6px; }
    p.lead { color: var(--muted); margin: 0 0 18px; }

    .panel { background: var(--card); border:1px solid var(--border); border-radius: 14px; padding: 16px; }
    .grid { display:grid; grid-template-columns: 1fr 280px; gap:16px; }
    @media (max-width: 900px){ .grid { grid-template-columns: 1fr; } }

    .dropzone {
      border: 2px dashed var(--border); background:#fff; border-radius: 14px; padding: 28px; text-align:center;
      transition: border-color .2s, background .2s, box-shadow .2s;
    }
    .dropzone.dragover { border-color: var(--primary); background:#f0f9ff; box-shadow: 0 0 0 6px var(--ring); }
    .dropzone input[type=file]{ display:none; }
    .dropzone .btn { display:inline-block; padding:10px 14px; border-radius:10px; border:1px solid var(--border); background:#fff; cursor:pointer; }
    .options { display:flex; flex-direction:column; gap:12px; }
    .field { display:flex; align-items:center; justify-content:space-between; gap:8px; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#fff; }
    .field label { font-size:14px; color: var(--muted); }
    .field input[type=range]{ width: 160px; }
    .muted { color: var(--muted); font-size: 13px; }
    .actions { display:flex; gap:8px; margin-top: 12px; }
    .primary { background: var(--primary); color:#fff; border: none; padding: 10px 14px; border-radius: 10px; cursor:pointer; }
    .ghost { background:#fff; color:var(--fg); border:1px solid var(--border); padding:10px 14px; border-radius:10px; cursor:pointer; }
    .primary:disabled, .ghost:disabled { opacity:.5; cursor:not-allowed; }

    .list { margin-top:16px; display:grid; gap:10px; }
    .item { display:grid; grid-template-columns: 72px 1fr auto; gap:12px; align-items:center; border:1px solid var(--border); background:#fff; border-radius:12px; padding:8px; }
    .thumb { width:72px; height:72px; border-radius:10px; object-fit:cover; border:1px solid var(--border); background:#f1f5f9; }
    .meta { min-width:0; }
    .name { font-size:14px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
    .note { font-size:12px; color:var(--muted); }
    .badge { font-size:11px; padding:2px 6px; border-radius:999px; border:1px solid var(--border); background:#fff; }
    .ok { color: var(--good); }
    .err { color: var(--bad); }
    footer { margin-top: 28px; color: var(--muted); font-size: 13px; }

    /* 광고 영역 가이드(실 AdSense 스니펫으로 교체) */
    .ad { border:1px dashed var(--border); border-radius:12px; padding:16px; text-align:center; color:var(--muted); background:#fff; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>HEIC/HEIF → JPG/PNG Converter</h1><a href="./lan/ko.html">한국어로 변경</a>
      <p class="lead">Everything runs <b>locally</b> in your browser. Convert multiple files at once and download them as a ZIP.</p>
    </header>

    <div class="grid">
      <!-- 좌측: 드롭존 & 결과 리스트 -->
      <section class="panel">
        <div id="dropzone" class="dropzone" tabindex="0" role="button" aria-label="Drag and drop or pick files">
          <p style="margin:0 0 12px">Drop your <b>HEIC/HEIF</b> files here</p>
          <label class="btn" for="fileInput">Choose files</label>
          <input id="fileInput" type="file" accept=".heic,.heif,image/heic,image/heif" multiple />
          <p class="muted" style="margin-top:10px">Supported: .heic, .heif · Large files OK · EXIF not preserved</p>
        </div>

        <div class="actions">
          <button id="convertBtn" class="primary" disabled>Start conversion</button>
          <button id="zipBtn" class="ghost" disabled>Download all as ZIP</button>
          <button id="clearBtn" class="ghost" disabled>Clear list</button>
        </div>

        <div id="list" class="list" aria-live="polite"></div>

        <footer>
          <p> ⚠️ <b>Privacy:</b> Files never leave your device; everything is processed in-memory in your browser.</p>
        </footer>
      </section>

      <!-- 우측: 옵션 & 광고 자리 -->
      <aside class="panel">
        <div class="options">
          <div class="field">
            <label for="fmt">Output format</label>
            <select id="fmt" aria-label="Output format">
              <option value="image/jpeg">JPG (recommended)</option>
              <option value="image/png">PNG</option>
            </select>
          </div>

          <div class="field" id="qualityField">
            <label for="quality">JPG quality <span id="qVal" class="badge">0.92</span></label>
            <input id="quality" type="range" min="0.5" max="1" step="0.01" value="0.92" />
          </div>

          <!-- <div class="ad"> -->
            <!-- ▶︎ 여기 AdSense 코드 삽입 (예시)
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXX" crossorigin="anonymous"></script>
            <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-XXXX" data-ad-slot="YYYY" data-ad-format="auto" data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            -->
            <!-- Ad slot (replace with AdSense) -->
          <!-- </div> -->

          <details>
            <summary>Help</summary>
            <ul class="muted">
              <li>All processing is local nothing is uploaded.</li>
              <li>EXIF metadata is typically stripped when re-encoding to JPG/PNG.</li>
              <li>PNG is lossless JPG is lossy but you can tune the quality.</li>
            </ul>
          </details>
        </div>
      </aside>
    </div>

    <section style="margin-top: 28px" class="panel">
      <h2 style="margin:0 0 8px">Why convert HEIC/HEIF?</h2>
      <p class="muted" style="margin:0">
        HEIC/HEIF is a high-efficiency format (e.g., used by iPhone). Some apps and services still lack support.
        This tool converts your images to widely compatible JPG/PNG right in your browser.
      </p>
    </section>

    <section style="margin-top: 16px" class="panel">
      <h2 style="margin:0 0 8px">FAQ</h2>
      <details><summary><b>Do you upload my files?</b></summary><p>No. Everything runs locally in your browser.</p></details>
      <details><summary><b>How to keep maximum quality?</b></summary><p>Choose PNG for lossless, or set JPG quality to 0.90+ to reduce artifacts.</p></details>
      <details><summary><b>Are large files supported?</b></summary><p>Yes, but processing speed depends on your device memory/CPU.</p></details>
    </section>

    <!-- <section style="margin-top: 16px" class="panel"> -->
      <!-- <div class="ad">Ad slot (article bottom)</div> -->
    <!-- </section> -->
  </div>

  <!-- heic2any (WebAssembly; CDN 사용 / 필요 시 로컬 호스팅 권장) -->
  <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
  <!-- JSZip (ZIP 다운로드용) -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script>
    // =========================
    // HEIC/HEIF → JPG/PNG 변환기 (영문 UI, 한글 주석)
    // - 100% 클라이언트 변환 (서버/DB 불필요)
    // - 배치 변환, ZIP 다운로드
    // =========================

    // DOM 참조
    const dropzone  = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const convertBtn= document.getElementById('convertBtn');
    const zipBtn    = document.getElementById('zipBtn');
    const clearBtn  = document.getElementById('clearBtn');
    const listEl    = document.getElementById('list');
    const fmtEl     = document.getElementById('fmt');
    const qualityEl = document.getElementById('quality');
    const qVal      = document.getElementById('qVal');
    const qualityField = document.getElementById('qualityField');

    /** 내부 상태 */
    const state = {
      queue: [],      // { file, status, outBlob, outName, thumbURL, error }
      processing: false
    };

    /** 유틸: 확장자 추출 */
    function ext(name=''){
      const i = name.lastIndexOf('.');
      return i>=0 ? name.slice(i+1).toLowerCase() : '';
    }

    /** 유틸: 파일명 교체 */
    function replaceExt(name, newExt){
      const i = name.lastIndexOf('.');
      const base = i>=0 ? name.slice(0, i) : name;
      return base + '.' + newExt;
    }

    /** 유틸: 썸네일 URL */
    function blobToThumbURL(blob){
      const url = URL.createObjectURL(blob);
      return url; // 썸네일로 계속 사용할 것이므로 해제 생략
    }

    /** UI 갱신 */
    function renderList(){
      listEl.innerHTML = '';
      state.queue.forEach((item, idx) => {
        const row = document.createElement('div');
        row.className = 'item';

        const img = document.createElement('img');
        img.className = 'thumb';
        img.alt = 'Thumbnail';
        img.src = item.thumbURL || '';
        row.appendChild(img);

        const meta = document.createElement('div');
        meta.className = 'meta';

        const nm = document.createElement('div');
        nm.className = 'name';
        nm.textContent = item.outName || item.file.name;
        meta.appendChild(nm);

        const note = document.createElement('div');
        note.className = 'note';
        if(item.status === 'done'){
          note.innerHTML = `<span class="ok">Done</span> • ${(item.outBlob.size/1024).toFixed(1)} KB`;
        } else if(item.status === 'error'){
          note.innerHTML = `<span class="err">Failed</span> • ${item.error || 'Unknown error'}`;
        } else if(item.status === 'converting'){
          note.textContent = 'Converting…';
        } else {
          note.textContent = 'Queued';
        }
        meta.appendChild(note);

        row.appendChild(meta);

        const actions = document.createElement('div');
        if(item.status === 'done' && item.outBlob){
          const a = document.createElement('a');
          a.textContent = 'Download';
          a.className = 'ghost';
          a.download = item.outName;
          a.href = URL.createObjectURL(item.outBlob);
          actions.appendChild(a);
        } else {
          const b = document.createElement('span');
          b.className = 'badge';
          b.textContent = item.status || 'Queued';
          actions.appendChild(b);
        }
        row.appendChild(actions);

        listEl.appendChild(row);
      });

      const hasItems = state.queue.length > 0;
      convertBtn.disabled = !hasItems || state.processing;
      zipBtn.disabled     = !hasItems || !state.queue.some(x=>x.status==='done' && x.outBlob);
      clearBtn.disabled   = !hasItems || state.processing;
    }

    /** 입력된 파일 큐에 추가 */
    function addFiles(files){
      const allowed = ['heic','heif'];
      for(const f of files){
        const e = ext(f.name);
        if(!allowed.includes(e)) continue; // HEIC/HEIF 외는 무시
        state.queue.push({
          file: f,
          status: 'queued',
          outBlob: null,
          outName: null,
          thumbURL: '',
          error: null
        });
      }
      renderList();
    }

    /** 변환 실행(순차 처리로 메모리 사용량 제어) */
    async function convertAll(){
      if(state.processing) return;
      state.processing = true;
      renderList();

      const toType = fmtEl.value; // 'image/jpeg' 또는 'image/png'
      const jpgQuality = parseFloat(qualityEl.value);

      for(const item of state.queue){
        if(item.status === 'done') continue;
        item.status = 'converting';
        renderList();

        try{
          // heic2any 옵션 구성
          const opts = { blob: item.file, toType };
          if(toType === 'image/jpeg'){
            opts.quality = jpgQuality; // 0~1
          }

          // HEIC → 지정 포맷 Blob
          const outBlob = await heic2any(opts);

          // 출력 파일명
          const newExt = (toType === 'image/png') ? 'png' : 'jpg';
          const outName = replaceExt(item.file.name, newExt);

          // 썸네일 URL
          const thumbURL = blobToThumbURL(outBlob);

          Object.assign(item, {
            status: 'done',
            outBlob,
            outName,
            thumbURL,
            error: null
          });
        }catch(err){
          console.error(err);
          item.status = 'error';
          item.error = (err && err.message) ? err.message : String(err);
        }
        renderList();
        // 다음 파일 처리 전 UI 양보
        await new Promise(r=>setTimeout(r, 0));
      }

      state.processing = false;
      renderList();
    }

    /** ZIP 다운로드 */
    async function downloadZip(){
      const doneItems = state.queue.filter(x=>x.status==='done' && x.outBlob);
      if(doneItems.length === 0) return;

      const zip = new JSZip();
      for(const it of doneItems){
        zip.file(it.outName, it.outBlob);
      }
      const blob = await zip.generateAsync({type:'blob'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `converted_${Date.now()}.zip`;
      a.click();
    }

    /** 목록 비우기 */
    function clearList(){
      if(state.processing) return;
      state.queue = [];
      renderList();
    }

    // 품질 슬라이더
    qualityEl.addEventListener('input', () => {
      qVal.textContent = Number(qualityEl.value).toFixed(2);
    });

    // 포맷 변경 시 JPG 품질 항목 표시/숨김
    function applyFormatUI(){
      const isJpg = fmtEl.value === 'image/jpeg';
      qualityField.style.display = isJpg ? 'flex' : 'none';
    }
    fmtEl.addEventListener('change', applyFormatUI);
    applyFormatUI();

    // 드래그앤드롭
    ;['dragenter','dragover'].forEach(ev=>{
      dropzone.addEventListener(ev, e => {
        e.preventDefault(); e.stopPropagation();
        dropzone.classList.add('dragover');
      });
    });
    ;['dragleave','drop'].forEach(ev=>{
      dropzone.addEventListener(ev, e => {
        e.preventDefault(); e.stopPropagation();
        dropzone.classList.remove('dragover');
      });
    });
    dropzone.addEventListener('drop', e=>{
      const dt = e.dataTransfer;
      if(dt && dt.files && dt.files.length){
        addFiles(dt.files);
      }
    });

    // 파일 선택(라벨만 사용해 중복 팝업 방지)
    fileInput.addEventListener('change', ()=>{
      if(fileInput.files && fileInput.files.length){
        addFiles(fileInput.files);
        fileInput.value = ''; // 동일 파일 재선택 허용
      }
    });

    // 버튼 이벤트
    convertBtn.addEventListener('click', convertAll);
    zipBtn.addEventListener('click', downloadZip);
    clearBtn.addEventListener('click', clearList);

    // 접근성: 키보드로 드롭존 포커스 시 Space/Enter로 파일 선택
    dropzone.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        document.querySelector('label[for="fileInput"]').click();
      }
    });

    // 페이지 이탈 방지(처리 중 경고)
    window.addEventListener('beforeunload', (e)=>{
      if(state.processing){
        e.preventDefault();
        e.returnValue = '';
      }
    });

    // 필수 라이브러리 로딩 체크
    window.addEventListener('load', ()=>{
      if(typeof window.heic2any !== 'function'){
        alert('Failed to load a required library. Check your network or host heic2any locally.');
      }
    });
  </script>
</body>
</html>
